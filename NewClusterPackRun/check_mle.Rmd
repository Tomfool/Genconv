---
title: "Check_MLE"
author: "Xiang Ji"
date: "March 20, 2015"
output: html_document
---

This R script is used for checking MLE of the Geneconv project

1, Read in tables
```{r}
rm(list=ls())  # clean up workspace
setwd("/Users/xji3/Genconv/NewClusterPackRun")

path.HKY <- "/Users/xji3/MixedFromCluster/NewPackageNewRun/"
path.MG94 <- "/Users/xji3/MixedFromCluster/NewPackageNewRun/"

path.HKY <- "/Users/xji3/FromCluster06012015/DataFiles/"
path.MG94 <- "/Users/xji3/FromCluster06012015/DataFiles/"

summary.list.MG94 <- c( 
  "MG94_clock_summary",
  "MG94_nonclock_summary", 
  "Force_MG94_clock_summary", 
  "Force_MG94_nonclock_summary"
  )
summary.list.HKY <- c( "HKY_nonclock_summary",
                       "HKY_clock_summary",
                       "Force_HKY_clock_summary", 
                       "Force_HKY_nonclock_summary"
                       )
#summary.list <- c("Force_MG94_clock_summary")
for (target.summary in summary.list.MG94){
  summary_file <- paste(path.MG94, target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(target.summary, summary_mat)
  }

for (target.summary in summary.list.HKY){
  summary_file <- paste(path.HKY, target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(target.summary, summary_mat)
  }

# read in directional model summary
summary.list.Dir <- c( 
  "MG94_clock_summary",
  "MG94_nonclock_summary"
  )
for (target.summary in summary.list.Dir){
  summary_file <- paste(path.MG94, "Dir_" , target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(paste("Dir_", target.summary, sep = ''), summary_mat)
  write.table(gsub("_", ".", paste("Dir_", target.summary, sep = '')), 
              paste(path.MG94, "Dir_", target.summary, sep = ''))
  }

# read in directional model summary
summary.list.Dir <- c( 
  "HKY_nonclock_summary",
  "HKY_clock_summary"
  )
for (target.summary in summary.list.Dir){
  summary_file <- paste(path.HKY, "Dir_" , target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(paste("Dir_", target.summary, sep = ''), summary_mat)
  write.table(gsub("_", ".", paste("Dir_", target.summary, sep = '')), 
              paste(path.HKY, "Dir_", target.summary, sep = ''))
  }



# read in gBGC model summary
summary.list.gBGC <- c( 
  "MG94_clock_summary",
  "MG94_nonclock_summary"
  )
for (target.summary in summary.list.gBGC){
  summary_file <- paste(path.MG94, "gBGC_" , target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(paste("gBGC_", target.summary, sep = ''), summary_mat)
  write.table(gsub("_", ".", paste("gBGC_", target.summary, sep = '')), 
              paste(path.MG94, "gBGC_", target.summary, sep = ''))
  }

# read in Dir gBGC model summary
summary.list.gBGC <- c( 
  "MG94_clock_summary",
  "MG94_nonclock_summary"
  )
for (target.summary in summary.list.gBGC){
  summary_file <- paste(path.MG94, "Dir_gBGC_" , target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(paste("Dir_gBGC_", target.summary, sep = ''), summary_mat)
  write.table(gsub("_", ".", paste("Dir_gBGC_", target.summary, sep = '')), 
              paste(path.MG94, "Dir_gBGC_", target.summary, sep = ''))
  }

# read in gBGC model summary
summary.list.gBGC <- c( 
  "HKY_nonclock_summary",
  "HKY_clock_summary"
  )
for (target.summary in summary.list.gBGC){
  summary_file <- paste(path.HKY, "gBGC_" , target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(paste("gBGC_", target.summary, sep = ''), summary_mat)
  write.table(gsub("_", ".", paste("gBGC_", target.summary, sep = '')), 
              paste(path.HKY, "gBGC_", target.summary, sep = ''))
  }

# read in Dir gBGC model summary
summary.list.gBGC <- c( 
  "HKY_nonclock_summary",
  "HKY_clock_summary"
  )
for (target.summary in summary.list.gBGC){
  summary_file <- paste(path.HKY, "Dir_gBGC_" , target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(paste("Dir_gBGC_", target.summary, sep = ''), summary_mat)
  write.table(gsub("_", ".", paste("Dir_gBGC_", target.summary, sep = '')), 
              paste(path.HKY, "Dir_gBGC_", target.summary, sep = ''))
  }

```


```{r}
check.suspicious <- function(sh.file, summary, model, clock, gBGC, dir, force, threshold = 1e-4){
  rerun <- file(sh.file, "a")
  sh.prefix <- "sbatch -o suspicious-%j.out --mail-type=FAIL --mail-user=xji3@ncsu.edu"
  sh.suffix <- "_"
  if (dir) {
    dir.cmd <- "--dir"
    sh.suffix <- paste(sh.suffix, "dir_", sep = "")
    } else {dir.cmd <- "--no-dir"}
  if (gBGC) {
    gBGC.cmd <- "--gBGC"
    sh.suffix <- paste(sh.suffix, "gBGC_", sep = "")
    } else gBGC.cmd <- "--no-gBGC"
  sh.suffix <- paste(sh.suffix, model, "_", sep = "")
  if (clock)  {  
    clock.cmd <- "--clock"
    sh.suffix <- paste(sh.suffix, "clock_", sep = "")
    }  else {
      clock.cmd <- "--no-clock"
      sh.suffix <- paste(sh.suffix, "nonclock_", sep = "")
      }
  if (force) { 
    force.cmd <- "--force"
    sh.suffix <- paste(sh.suffix, "force_", sep = "")
    }  else force.cmd <- "--no-force"
  
  idx <- which(rownames(summary) %in% "(N0,kluyveri)")
  print(colnames(summary)[(summary[idx, ] < threshold)])
  for( pair in colnames(summary)[(summary[idx, ] < threshold)]){
    paralog <- strsplit(pair, split = "_")[[1]]
    pair.sh.name <- paste("./NewRun/", pair, sh.suffix, "suspicious.sh", sep = "")
    pair.sh <- file(pair.sh.name, "w+")
    #txt.suffix <- paste(pair, sh.suffix, "suspicious_basinhopping_PrintScreen.txt", sep = "")
    txt.suffix <- paste(pair, sh.suffix, "suspicious_plotLL_PrintScreen.txt", sep = "")
    #sh.txt <- paste("python", "Run_unfinished.py", 
    sh.txt <- paste("python", "PlotLL.py",                 
                    #sh.txt <- paste("/Library/Frameworks/Python.framework/Versions/7.3/bin/python", "Run_unfinished.py", 
                    "--paralog1", paralog[1], "--paralog2", paralog[2], 
                    force.cmd, gBGC.cmd, dir.cmd, clock.cmd, "--model", model, 
                    ">", txt.suffix, sep = " ")
    writeLines(c("#!/bin/bash", sh.txt), pair.sh)
    close(pair.sh)
    writeLines(paste(sh.prefix, pair.sh.name, sep = " "), rerun.sh)
    #writeLines(cbind(paste("chmod +x", pair.sh.name, sep = " "), pair.sh.name), rerun.sh)
    }
  close(rerun.sh)
  }
```

Now generate .sh files to re-run the suspicious pairs.

```{r}
sh.file <- "./Rerun_Suspicious.sh"
rerun.sh <- file(sh.file, "w+")
writeLines("#!/bin/bash", rerun.sh)
close(rerun.sh)
threshold <- 1e-3
# MG94 Models
# Dir gBGC MG94 Clock
check.suspicious(sh.file, summary = Dir_gBGC_MG94_clock_summary, model = "MG94",clock = TRUE, gBGC = TRUE,
                 dir = TRUE, force = FALSE, threshold = threshold)
# Dir gBGC MG94 nonClock
check.suspicious(sh.file, summary = Dir_gBGC_MG94_nonclock_summary, model = "MG94",clock = FALSE, gBGC = TRUE,
                 dir = TRUE, force = FALSE, threshold = threshold)

# gBGC MG94 Clock
check.suspicious(sh.file, summary = gBGC_MG94_clock_summary, model = "MG94",clock = TRUE, gBGC = TRUE,
                 dir = FALSE, force = FALSE, threshold = threshold)
# gBGC MG94 nonClock
check.suspicious(sh.file, summary = gBGC_MG94_nonclock_summary, model = "MG94",clock = FALSE, gBGC = TRUE,
                 dir = FALSE, force = FALSE, threshold = threshold)

# Dir MG94 Clock
check.suspicious(sh.file, summary = Dir_MG94_clock_summary, model = "MG94",clock = TRUE, gBGC = FALSE,
                 dir = TRUE, force = FALSE, threshold = threshold)
# Dir MG94 nonClock
check.suspicious(sh.file, summary = Dir_MG94_nonclock_summary, model = "MG94",clock = FALSE, gBGC = FALSE,
                 dir = TRUE, force = FALSE, threshold = threshold)

# MG94 Clock
check.suspicious(sh.file, summary = MG94_clock_summary, model = "MG94",clock = TRUE, gBGC = FALSE,
                 dir = FALSE, force = FALSE, threshold = threshold)
# MG94 nonClock
check.suspicious(sh.file, summary = MG94_nonclock_summary, model = "MG94",clock = FALSE, gBGC = FALSE,
                 dir = FALSE, force = FALSE, threshold = threshold)

# MG94 Force Clock
check.suspicious(sh.file, summary = Force_MG94_clock_summary, model = "MG94",clock = TRUE, gBGC = FALSE,
                 dir = FALSE, force = TRUE, threshold = threshold)
# MG94 Force nonClock
check.suspicious(sh.file, summary = Force_MG94_nonclock_summary, model = "MG94",clock = FALSE, gBGC = FALSE,
                 dir = FALSE, force = TRUE, threshold = threshold)

# HKY Models 
# Dir gBGC HKY Clock
check.suspicious(sh.file, summary = Dir_gBGC_HKY_clock_summary, model = "HKY",clock = TRUE, gBGC = TRUE,
                 dir = TRUE, force = FALSE, threshold = threshold)
# Dir gBGC HKY nonClock
check.suspicious(sh.file, summary = Dir_gBGC_HKY_nonclock_summary, model = "HKY",clock = FALSE, gBGC = TRUE,
                 dir = TRUE, force = FALSE, threshold = threshold)

# gBGC HKY Clock
check.suspicious(sh.file, summary = gBGC_HKY_clock_summary, model = "HKY",clock = TRUE, gBGC = TRUE,
                 dir = FALSE, force = FALSE, threshold = threshold)
# gBGC HKY nonClock
check.suspicious(sh.file, summary = gBGC_HKY_nonclock_summary, model = "HKY",clock = FALSE, gBGC = TRUE,
                 dir = FALSE, force = FALSE, threshold = threshold)

# Dir HKY Clock
check.suspicious(sh.file, summary = Dir_HKY_clock_summary, model = "HKY",clock = TRUE, gBGC = FALSE,
                 dir = TRUE, force = FALSE, threshold = threshold)
# Dir HKY nonClock
check.suspicious(sh.file, summary = Dir_HKY_nonclock_summary, model = "HKY",clock = FALSE, gBGC = FALSE,
                 dir = TRUE, force = FALSE, threshold = threshold)

# HKY Clock
check.suspicious(sh.file, summary = HKY_clock_summary, model = "HKY",clock = TRUE, gBGC = FALSE,
                 dir = FALSE, force = FALSE, threshold = threshold)
# HKY nonClock
check.suspicious(sh.file, summary = HKY_nonclock_summary, model = "HKY",clock = FALSE, gBGC = FALSE,
                 dir = FALSE, force = FALSE, threshold = threshold)

# HKY Force Clock
check.suspicious(sh.file, summary = Force_HKY_clock_summary, model = "HKY",clock = TRUE, gBGC = FALSE,
                 dir = FALSE, force = TRUE, threshold = threshold)
# HKY Force nonClock
check.suspicious(sh.file, summary = Force_HKY_nonclock_summary, model = "HKY",clock = FALSE, gBGC = FALSE,
                 dir = FALSE, force = TRUE, threshold = threshold)

```

####Now check lnL improvements

```{r}
# nonclock models
# HKY
HKY_nonclock_summary[2, ] - Force_HKY_nonclock_summary[2, ]
Dir_HKY_nonclock_summary[2, ] - HKY_nonclock_summary[2, ]
gBGC_HKY_nonclock_summary[2, ] - HKY_nonclock_summary[2, ]
Dir_gBGC_HKY_nonclock_summary[2, ] - Dir_HKY_nonclock_summary[2, ]
Dir_gBGC_HKY_nonclock_summary[2, ] - gBGC_HKY_nonclock_summary[2, ]
# MG94
MG94_nonclock_summary[2, ] - Force_MG94_nonclock_summary[2, ]
Dir_MG94_nonclock_summary[2, ] - MG94_nonclock_summary[2, ]
gBGC_MG94_nonclock_summary[2, ] - MG94_nonclock_summary[2, ]
Dir_gBGC_MG94_nonclock_summary[2, ] - Dir_MG94_nonclock_summary[2, ]
Dir_gBGC_MG94_nonclock_summary[2, ] - gBGC_MG94_nonclock_summary[2, ]
```

```{r}
# clock models
# HKY
HKY_clock_summary[2, ] - Force_HKY_clock_summary[2, ]
Dir_HKY_clock_summary[2, ] - HKY_clock_summary[2, ]
gBGC_HKY_clock_summary[2, ] - HKY_clock_summary[2, ]
Dir_gBGC_HKY_clock_summary[2, ] - Dir_HKY_clock_summary[2, ]
Dir_gBGC_HKY_clock_summary[2, ] - gBGC_HKY_clock_summary[2, ]
# MG94
MG94_clock_summary[2, ] - Force_MG94_clock_summary[2, ]
Dir_MG94_clock_summary[2, ] - MG94_clock_summary[2, ]
gBGC_MG94_clock_summary[2, ] - MG94_clock_summary[2, ]
Dir_gBGC_MG94_clock_summary[2, ] - Dir_MG94_clock_summary[2, ]
Dir_gBGC_MG94_clock_summary[2, ] - gBGC_MG94_clock_summary[2, ]
```


####Now check lnL improvements between clock and nonclock cases

```{r}
# HKY
Force_HKY_nonclock_summary[2, ] - Force_HKY_clock_summary[2, ]
HKY_nonclock_summary[2, ] - HKY_clock_summary[2, ]
Dir_HKY_nonclock_summary[2, ] - Dir_HKY_clock_summary[2, ]
gBGC_HKY_nonclock_summary[2, ] - gBGC_HKY_clock_summary[2, ]
Dir_gBGC_HKY_nonclock_summary[2, ] - Dir_gBGC_HKY_clock_summary[2, ]
# MG94
Force_MG94_nonclock_summary[2, ] - Force_MG94_clock_summary[2, ]
MG94_nonclock_summary[2, ] - MG94_clock_summary[2, ]
Dir_MG94_nonclock_summary[2, ] - Dir_MG94_clock_summary[2, ]
gBGC_MG94_nonclock_summary[2, ] - gBGC_MG94_clock_summary[2, ]
Dir_gBGC_MG94_nonclock_summary[2, ] - Dir_gBGC_MG94_clock_summary[2, ]
```

##05082015
####Now create summary lnL table

```{r}
paml.summary.file <- "/Users/xji3/Genconv/NewClusterPackRun/NewPairsAlignment/paml_summary.txt"
all <- readLines(paml.summary.file, n = -1)
col.names <- strsplit(all[1], ' ')[[1]][-1]
row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
paml_mat <- as.matrix(read.table(paml.summary.file, 
                                 row.names = row.names, 
                                 col.names = col.names))
col.names <- colnames(HKY_nonclock_summary)
lnL.mat <- cbind(#colnames(Dir_gBGC_HKY_clock_summary), 
  Force_HKY_nonclock_summary[2, ],
  HKY_nonclock_summary[2, ],
  Dir_HKY_nonclock_summary[2, ],
  gBGC_HKY_nonclock_summary[2, ],
  Dir_gBGC_HKY_nonclock_summary[2, ], 
  Force_MG94_nonclock_summary[2, ],
  MG94_nonclock_summary[2, ],
  Dir_MG94_nonclock_summary[2, ],
  gBGC_MG94_nonclock_summary[2, ],
  Dir_gBGC_MG94_nonclock_summary[2, ],
  
  Force_HKY_clock_summary[2, ],
  HKY_clock_summary[2, ],
  Dir_HKY_clock_summary[2, ],
  gBGC_HKY_clock_summary[2, ],
  Dir_gBGC_HKY_clock_summary[2, ], 
  Force_MG94_clock_summary[2, ],
  MG94_clock_summary[2, ],
  Dir_MG94_clock_summary[2, ],
  gBGC_MG94_clock_summary[2, ],
  Dir_gBGC_MG94_clock_summary[2, ], 
  
  # add paml results
  paml_mat[1, col.names], 
  paml_mat[2, col.names],
  paml_mat[5, col.names],
  paml_mat[6, col.names]
  )
col.names <- c(#"pairs", 
  "HKY Force nonclock", "HKY nonclock", "HKY Dir nonclock",
  "HKY gBGC nonclock", "HKY gBGC Dir nonclock",
  "MG94 Force nonclock", "MG94 nonclock", "MG94 Dir nonclock",
  "MG94 gBGC nonclock", "MG94 gBGC Dir nonclock", 
  
  "HKY Force clock", "HKY clock", "HKY Dir clock",
  "HKY gBGC clock", "HKY gBGC Dir clock",
  "MG94 Force clock", "MG94 clock", "MG94 Dir clock",
  "MG94 gBGC clock", 
  "MG94 gBGC Dir clock", 
  
  # add paml results
  "MG94 codeml tree length",
  "MG94 codeml lnL",
  "HKY baseml tree length",
  "HKY baseml lnL"
  )
colnames(lnL.mat) <- col.names
write.table(lnL.mat, paste( "/Users/xji3/MixedFromCluster/", "lnL_matrix", sep = ""))
#b <- read.table(paste( "/Users/xji3/MixedFromCluster/", "lnL_matrix", sep = ""))
```

##06032015
####Now check Covariance matrix by hessian approximation

```{r}
summary.list <- c( "HKY_nonclock_hessian",
                   "Dir_HKY_nonclock_hessian",
                   "Dir_gBGC_HKY_nonclock_hessian", 
                   "gBGC_HKY_nonclock_hessian",
                   "MG94_nonclock_hessian",
                   "Dir_MG94_nonclock_hessian",
                   "Dir_gBGC_MG94_nonclock_hessian", 
                   "gBGC_MG94_nonclock_hessian"
                   )
path.hessian <- "/Users/xji3/FromCluster06012015/NewPackageNewRun/"
path.hessian <- "/Users/xji3/FromCluster06012015/DataFiles/"
for (target.summary in summary.list){
  summary_file <- paste(path.hessian, target.summary, '.txt', sep = '')
  all <- readLines(summary_file, n = -1)
  col.names <- strsplit(all[1], ' ')[[1]][-1]
  row.names <- strsplit(all[length(all)], ' ')[[1]][-1]
  summary_mat <- as.matrix(read.table(summary_file, 
                                      row.names = row.names, 
                                      col.names = col.names))
  assign(target.summary, summary_mat)
  }

new.lnL.mat <- lnL.mat[lnL.mat[, "MG94 codeml tree length"] < 3.0, ]
filtered.pairs <- rownames(new.lnL.mat)

```

####Check posterior estimates

```{r}
library(matrixStats)
# install.packages("matrixStats")
# MG94 nonclock model
mean.MG94.nonclock <- rowMeans(MG94_nonclock_summary[22:33, filtered.pairs])
sd.MG94.nonclock <- rowSds(MG94_nonclock_summary[22:33, filtered.pairs])
# MG94 Dir nonclock model
mean.MG94.Dir.nonclock <- rowMeans(Dir_MG94_nonclock_summary[23:34, filtered.pairs])
sd.MG94.Dir.nonclock <- rowSds(Dir_MG94_nonclock_summary[23:34, filtered.pairs])
# MG94 gBGC Dir nonclock model
mean.MG94.Dir.gBGC.nonclock <- rowMeans(Dir_gBGC_MG94_nonclock_summary[24:35, filtered.pairs])
sd.MG94.Dir.gBGC.nonclock <- rowSds(Dir_gBGC_MG94_nonclock_summary[24:35, filtered.pairs])

x <- 1:12
x.label <- rownames(MG94_nonclock_summary)[22:33]

plot(x, mean.MG94.nonclock, 
     ylim = range(c(mean.MG94.nonclock - sd.MG94.nonclock, mean.MG94.nonclock + sd.MG94.nonclock)),
     pch = 19, xlab = "edges", ylab = "posterior tau estimate", main = "MG94 nonclock")
arrows(x, mean.MG94.nonclock - sd.MG94.nonclock, x, mean.MG94.nonclock + sd.MG94.nonclock, 
       length = 0.05, angle = 90, code = 3)
text(x, mean.MG94.nonclock + 0.3, labels = x.label, cex = 0.7)

plot(x, mean.MG94.Dir.nonclock, 
     ylim = range(c(mean.MG94.Dir.nonclock - sd.MG94.Dir.nonclock, mean.MG94.Dir.nonclock + sd.MG94.Dir.nonclock)),
     pch = 19, xlab = "edges", ylab = "posterior tau estimate", main = "MG94 Dir nonclock")
arrows(x, mean.MG94.Dir.nonclock - sd.MG94.Dir.nonclock, x, mean.MG94.Dir.nonclock + sd.MG94.Dir.nonclock, 
       length = 0.05, angle = 90, code = 3)
text(x, mean.MG94.Dir.nonclock + 0.3, labels = x.label, cex = 0.7)

plot(x, mean.MG94.Dir.gBGC.nonclock, 
     ylim = range(c(mean.MG94.Dir.gBGC.nonclock - sd.MG94.Dir.gBGC.nonclock, mean.MG94.Dir.gBGC.nonclock + sd.MG94.Dir.gBGC.nonclock)),
     pch = 19, xlab = "edges", ylab = "posterior tau estimate", main = "MG94 Dir gBGC nonclock")
arrows(x, mean.MG94.Dir.gBGC.nonclock - sd.MG94.Dir.gBGC.nonclock, x, mean.MG94.Dir.gBGC.nonclock + sd.MG94.Dir.gBGC.nonclock, 
       length = 0.05, angle = 90, code = 3)
text(x, mean.MG94.Dir.gBGC.nonclock + 0.3, labels = x.label, cex = 0.7)

# now plot 14 pairs into one graph
library(RColorBrewer)
# install.packages("RColorBrewer")
dot.colors <- brewer.pal(7, "Set1")
#dot.colors <- palette()
target.mat.list <- c("MG94_nonclock_summary", "Dir_MG94_nonclock_summary", "Dir_gBGC_MG94_nonclock_summary")
for (j in 1:3){
  target.mat <- get(target.mat.list[j])
  y.max <- max(target.mat[(21 + j):(32 + j), filtered.pairs])
  for (i in 1:7){
    plot(x, target.mat[(21 + j):(32 + j), filtered.pairs[2 * i - 1]], col = dot.colors[i], type = "b", pch = 20, ylim = c(0.0, y.max),
         ylab = "posterior tau estimate", main = gsub("_summary", "", target.mat.list[j]), xlab = "edges") 
    par(new = TRUE)  
    plot(x, target.mat[(21 + j):(32 + j), filtered.pairs[2 * i]], col = dot.colors[i], type = "o", lty = 2, pch = 22, ylim = c(0.0, y.max),
         ylab = "posterior tau estimate", main = gsub("_summary", "", target.mat.list[j]), xlab = "edges") 
    par(new = TRUE)  
    }
  par(new = FALSE)  
  }

```

####Check Posterior expected number of Directional geneconv events on each branch
Plot the ratio of geneconv events from Paralog1 -> Paralog2 over the opposite direction.

```{r}
# now plot 14 pairs into one graph
library(RColorBrewer)
# install.packages("RColorBrewer")
dot.colors <- brewer.pal(7, "Set1")
all.ratio <- MG94_nonclock_summary[34:45, filtered.pairs] / MG94_nonclock_summary[46:57, filtered.pairs]
all.ratio[is.nan(all.ratio)] <- 0.0
y.max <- max(all.ratio) 
for (i in 1:7){
  ratio.single.pair <- MG94_nonclock_summary[34:45, filtered.pairs[2 * i - 1]] / MG94_nonclock_summary[46:57, filtered.pairs[2 * i - 1]]
  ratio.single.pair[is.nan(ratio.single.pair)] <- 0.0  # replace NAN with 0.0
  plot(x, ratio.single.pair, col = dot.colors[i], type = "b", pch = 20, ylim = c(0.0, y.max),
       ylab = "posterior tau estimate", main = "MG94 nonclock", xlab = "edges") 
  par(new = TRUE)  
  ratio.single.pair <- MG94_nonclock_summary[34:45, filtered.pairs[2 * i]] / MG94_nonclock_summary[46:57, filtered.pairs[2 * i]]
  ratio.single.pair[is.nan(ratio.single.pair)] <- 0.0  # replace NAN with 0.0
  plot(x, ratio.single.pair, col = dot.colors[i], type = "o", lty = 2, pch = 22, ylim = c(0.0, y.max),
       ylab = "posterior tau estimate", main = "MG94 nonclock", xlab = "edges") 
  par(new = TRUE)  
  }
par(new = FALSE)

for (i in 1:length(filtered.pairs)){
  #attach(mtcars)
  par(mfrow = c(1, 2))
  ratio.single.pair <- MG94_nonclock_summary[34:45, filtered.pairs[i]] / MG94_nonclock_summary[46:57, filtered.pairs[i]]
  ratio.single.pair[is.nan(ratio.single.pair)] <- 0.0  # replace NAN with 0.0
  plot(x, ratio.single.pair, col = dot.colors[1], type = "b", pch = 20, ylim = c(0.0, y.max),
       ylab = "ratio of posterior expected number of directional IGC", main = "non-directional", xlab = "edges") 
  ratio.single.pair <- Dir_MG94_nonclock_summary[35:46, filtered.pairs[i]] / Dir_MG94_nonclock_summary[47:58, filtered.pairs[i]]
  ratio.single.pair[is.nan(ratio.single.pair)] <- 0.0  # replace NAN with 0.0
  plot(x, ratio.single.pair, col = dot.colors[1], type = "b", pch = 20, ylim = c(0.0, y.max),
       ylab = "ratio of posterior expected number of directional IGC", main = "directional", xlab = "edges") 
  # Now show the likelihood improvement again
  print(filtered.pairs[i])
  print(paste("lnL increase = ", Dir_MG94_nonclock_summary[2, filtered.pairs[i]] - MG94_nonclock_summary[2, filtered.pairs[i]], sep = " "))
  }

```

Pair "YNL301C_YOL120C" and pair "YER074W_YIL069C" seem good evidence as directional pattern from the posterior expected number of directional geneconversion events 
from a non-directional model. The ratio of pair "YER074W_YIL069C" starts from 5th edge because the "N0-N1" branch length is estimated ~ 0.0 which 
shifts the duplication point to node N1.
